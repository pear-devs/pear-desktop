language: node_js
node_js: "10"
env:
  - ELECTRON_CACHE=$HOME/.cache/electron ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

jobs:
  include:
    - os: osx
      osx_image: xcode11.3
    - os: linux
      dist: xenial

cache:
  yarn: false
  directories:
    - $HOME/.cache/electron
    - $HOME/.cache/electron-builder

script:
  - |
    if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      yarn run release:linux
    else
      yarn run release:mac
    fi
before_cache:
  - rm -rf $HOME/.cache/electron-builder
before_install:
  - rm -rf node_modules
  # Install Rust and Cargo
  - curl https://sh.rustup.rs -sSf > /tmp/rustup.sh
  - sh /tmp/rustup.sh -y
  - export PATH="$HOME/.cargo/bin:$PATH"
  - source "$HOME/.cargo/env"
  # Install dependencies
  - travis_wait 30 yarn --frozen-lockfile

branches:
  except:
    - "/^v\\d+\\.\\d+\\.\\d+$/"
